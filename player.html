<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playing | MyFlix</title>
    <link rel="stylesheet" href="style.css?v=2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: var(--dark-bg);
            color: var(--text-color);
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
        }

        /* --- Header / Nav --- */
        .player-nav {
            display: flex;
            align-items: center;
            padding: 15px 4%;
            background: var(--nav-bg);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--glass-border);
        }

        .back-btn {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0.8;
            transition: all 0.2s;
            font-family: inherit;
        }

        .back-btn:hover {
            opacity: 1;
            transform: translateX(-5px);
            color: var(--primary);
        }

        .logo-text {
            margin-left: 20px;
            font-size: 20px;
            font-weight: 900;
            letter-spacing: -1px;
            background: linear-gradient(to right, #fff, #a1a1a1);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- "Normal Mode" Player Layout --- */
        .video-wrapper {
            width: 100%;
            max-width: 1100px;
            /* Constrained width */
            margin: 30px auto 0;
            /* Center with spacing */
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.4);
            background: #000;
            position: relative;
            z-index: 10;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            /* 16:9 Aspect Ratio */
            height: 0;
            background: #000;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* --- Content Layout --- */
        .content-wrapper {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px 0 60px;
            display: none;
            /* Hidden as per request */
        }

        /* ... existing desktop styles ... */

        /* Mobile Immersive Mode */
        @media (max-width: 768px) {

            /* Hide standard nav */
            .player-nav {
                display: none !important;
            }

            /* Full Screen Video Container */
            .video-wrapper {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                margin: 0;
                border-radius: 0;
                z-index: 2000;
                background: #000;
                display: flex;
                align-items: center;
                /* Vertical Center */
                justify-content: center;
            }

            .video-container {
                width: 100%;
                /* Maintain aspect ratio */
            }

            /* Floating Back Button for Mobile */
            .mobile-back-btn {
                display: flex !important;
                position: absolute;
                top: 20px;
                left: 20px;
                z-index: 2001;
                background: rgba(0, 0, 0, 0.5);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: #fff;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
                cursor: pointer;
            }
        }
    </style>
</head>

<body>

    <nav class="player-nav">
        <button class="back-btn" onclick="history.back()">
            <i class="fa-solid fa-arrow-left"></i> Back
        </button>
        <div class="logo-text">MYFLIX PLAYER</div>
    </nav>

    <div class="video-wrapper">
        <!-- Floating Back Button (Mobile Only) -->
        <div class="mobile-back-btn" onclick="history.back()" style="display: none;">
            <i class="fa-solid fa-arrow-left"></i>
        </div>

        <div class="video-container">
            <!-- Sandbox: Exclude allow-popups to block ads if possible -->
            <iframe id="video-player" src=""
                sandbox="allow-forms allow-pointer-lock allow-same-origin allow-scripts allow-top-navigation allow-presentation"
                allowfullscreen></iframe>
        </div>
    </div>

    <div class="content-wrapper" style="display: none;">
        <!-- Removed per user request -->
    </div>

    <script type="module">
        import CONFIG from './config.js';

        // Parse URL
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        const type = urlParams.get('type');
        const season = urlParams.get('season') || 1;
        const episode = urlParams.get('episode') || 1;

        // Init
        async function initPlayer() {
            if (!id || !type) {
                alert("Invalid media.");
                history.back();
                return;
            }

            // 1. Set Iframe Src
            const iframe = document.getElementById('video-player');
            const src = type === 'movie' ?
                `https://vidsrc.cc/v2/embed/movie/${id}` :
                `https://vidsrc.cc/v2/embed/tv/${id}/${season}/${episode}`;
            iframe.src = src;

            // 2. Fetch Details (Just for Tab Title)
            try {
                const res = await fetch(`${CONFIG.BASE_URL}/${type}/${id}?api_key=${CONFIG.API_KEY}`);
                const data = await res.json();
                const title = data.title || data.name;
                document.title = `${title} - Playing`;

            } catch (e) {
                console.error("Error fetching details:", e);
            }
        }

        // Run
        initPlayer();
    </script>
</body>

</html>